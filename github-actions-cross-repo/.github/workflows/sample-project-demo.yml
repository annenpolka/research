name: Sample Project Demo

on:
  workflow_dispatch:
  push:
    branches: [main, master]
    paths:
      - 'sample-project/**'

jobs:
  run-sample:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout this repository
        uses: actions/checkout@v4

      - name: Checkout external library - toolkit
        uses: actions/checkout@v4
        with:
          repository: actions/toolkit
          path: external-libs/toolkit

      - name: Checkout external library - checkout
        uses: actions/checkout@v4
        with:
          repository: actions/checkout
          path: external-libs/checkout

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        working-directory: sample-project
        run: npm install

      - name: Run sample project
        working-directory: sample-project
        run: node main.js

      - name: Verify external libraries
        run: |
          echo "=== Verifying external libraries are accessible ==="
          ls -la external-libs/
          echo ""
          echo "=== Toolkit packages ==="
          ls -la external-libs/toolkit/packages/ || echo "No packages directory"
          echo ""
          echo "=== Checkout action.yml ==="
          head -n 10 external-libs/checkout/action.yml || echo "No action.yml found"

      - name: Create integration report
        run: |
          cat > integration-report.md << 'EOF'
          # Integration Report

          ## External Libraries Used

          - **actions/toolkit**: GitHub Actions Toolkit
          - **actions/checkout**: Checkout action source code

          ## Integration Test Results

          ✓ Successfully checked out external repositories
          ✓ External libraries accessible from main project
          ✓ Sample project executed without errors

          ## Files Available

          ```
          project/
          ├── sample-project/        # Main project
          │   └── main.js           # Uses external libraries
          └── external-libs/        # External repositories
              ├── toolkit/          # From actions/toolkit
              └── checkout/         # From actions/checkout
          ```

          ## Use Cases Demonstrated

          1. Checking out multiple external repositories
          2. Accessing files from external repositories
          3. Using external code in main project
          4. Organizing external dependencies

          EOF

          cat integration-report.md

      - name: Upload report
        uses: actions/upload-artifact@v4
        with:
          name: integration-report
          path: integration-report.md
