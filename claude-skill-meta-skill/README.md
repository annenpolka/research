# Claude Skill メタスキル研究

## 概要

このプロジェクトは、Claude Codeのスキル機能を使って「新しいスキルを作成するスキル」（メタスキル）を開発する研究です。メタスキルは、開発者が独自のワークフローを自動化するための新しいスキルを簡単に作成できるようにするツールです。

## 動機

Claude Codeのスキル機能は強力ですが、新しいスキルを作成するには以下の知識が必要です：

1. **YAMLフロントマター**の正しい構文と必須フィールド
2. **ファイル構造**の設計パターン
3. **説明文（description）**の効果的な書き方（Claudeがスキルを発見するために重要）
4. **ツールパーミッション**の適切な設定
5. **ワークフローの構造化**とベストプラクティス

メタスキルを提供することで、これらの知識がなくてもClaudeが対話的にユーザーをガイドし、高品質なスキルを作成できるようになります。

## 調査内容

### 1. Claude Codeスキル機能の理解

#### スキルの基本構造

スキルは以下の要素で構成されます：

```
skill-name/
├── SKILL.md           # 必須: メインスキル定義
├── REFERENCE.md       # オプション: 詳細リファレンス
├── EXAMPLES.md        # オプション: 使用例
├── templates/         # オプション: テンプレートファイル
└── scripts/           # オプション: ヘルパースクリプト
```

#### SKILL.mdの構造

```yaml
---
name: skill-name
description: スキルの説明（最大1024文字）
allowed-tools: Read, Write, Edit  # オプション: ツールの制限
---

# スキルの内容（マークダウン）
```

**重要なポイント：**
- `name`: 小文字、数字、ハイフンのみ（最大64文字）
- `description`: Claudeがスキルを発見するための最も重要な要素
  - いつスキルを使うべきかを明確に記述
  - アクション動詞で始める
  - 具体的なトリガーシナリオを含める
- `allowed-tools`: セキュリティ制限を設定（read-onlyスキルなど）

### 2. 既存のメタスキル例

#### session-start-hook スキル

既存の`session-start-hook`スキルは、SessionStartフックを作成するためのメタスキル的な機能を持っています：

**特徴：**
- 段階的なワークフロー（8ステップ）
- TodoWriteツールの使用を推奨
- 各ステップで検証を実施
- 最終的なサマリーフォーマットを提供
- 非同期モードとの比較説明

**学んだ設計パターン：**
1. **明確なワークフロー**: 番号付きステップで構造化
2. **検証の組み込み**: 各段階で動作確認
3. **選択肢の説明**: 同期/非同期のトレードオフを説明
4. **完了メッセージ**: ユーザーへの明確なフィードバック

### 3. メタスキルの設計パターン

研究の結果、以下の4つの主要な設計パターンを特定しました：

#### パターン1: ワークフロー自動化
多段階プロセス（ビルド、デプロイ、テスト）に使用
- 明確な番号付きステップ
- TodoWriteの統合
- 各段階での検証
- 最終サマリー

#### パターン2: コード生成
ファイルやコードスニペットの生成に使用
- テンプレートベースのアプローチ
- ユーザー入力の収集
- 生成されたコードの検証
- 使用例の提供

#### パターン3: 分析＆レビュー
コードレビュー、監査、分析タスクに使用
- read-onlyツール（`allowed-tools: Read, Grep, Glob`）
- 構造化された出力フォーマット
- 明確な基準/チェックリスト
- 実行可能な推奨事項

#### パターン4: インタラクティブガイド
複雑なタスクの教育やガイドに使用
- 段階的な情報開示
- ステップバイステップの指示
- 決定木
- FAQとトラブルシューティング

## 実装: skill-creator メタスキル

### 機能

`skill-creator`は、新しいClaude Codeスキルを作成するためのメタスキルです。

**主な機能：**
1. **要件の理解**: ユーザーと対話して目的とスコープを明確化
2. **構造の設計**: 複雑さとツールパーミッションに基づいて設計
3. **SKILL.mdの生成**: 適切なフロントマターとコンテンツ構造
4. **サポートファイルの追加**: 必要に応じて追加ドキュメントを作成
5. **検証**: YAML構文、命名規則、完全性のチェック
6. **テスト**: トリガーシナリオとワークフローのテスト
7. **ドキュメント**: 使用方法と共有方法の説明

### ワークフロー

```
1. 要件理解
   ↓
2. 構造設計（Simple/Moderate/Complex）
   ↓
3. SKILL.md作成
   - YAMLフロントマター
   - マークダウンコンテンツ
   ↓
4. サポートファイル追加（必要に応じて）
   ↓
5. 検証
   - YAML構文
   - 命名規則
   - 完全性
   ↓
6. テスト
   - トリガーテスト
   - 実行テスト
   - 出力テスト
   ↓
7. ドキュメント & 配布
```

### 使用例

ユーザー: "APIテストを自動化するスキルを作りたい"

skill-creator が実行する処理：
1. 質問でスコープを明確化（REST API? GraphQL? モックは必要?）
2. ツールパーミッションを決定（Read, Write, Bash）
3. ファイル構造を設計（SKILL.md + EXAMPLES.md + templates/）
4. SKILL.mdを生成（適切な description フィールドを含む）
5. テンプレートファイルを作成（api-test-template.js など）
6. 検証とテスト
7. 使用方法をドキュメント化

### ツールパーミッション設定

skill-creator は read-only + write 操作のみに制限：

```yaml
allowed-tools: Read, Write, Grep, Glob, Bash, TodoWrite
```

これにより、スキル作成プロセスで必要な操作のみを許可し、セキュリティを確保します。

## 発見と洞察

### 1. description フィールドの重要性

スキルの`description`は単なる説明文ではなく、Claudeがスキルを発見し活性化するための**最も重要な要素**です。

**効果的な description の要素：**
- アクション動詞で開始
- 具体的なトリガーシナリオを含む
- キーワードを戦略的に配置
- 簡潔でありながら包括的（< 1024文字）

例：
```yaml
# 悪い例
description: A skill for testing APIs

# 良い例
description: Creating API integration tests with mocking. Use when the user needs to test REST APIs, create mock responses, or validate API contracts.
```

### 2. Progressive Disclosure（段階的開示）

Claude Codeは、コンテキスト効率のために「段階的開示」を使用します：
- SKILL.mdをまず読み込む
- サポートファイルは文脈的に関連する場合のみロード

**設計への影響：**
- SKILL.mdを焦点を絞った内容に保つ（< 500行）
- 詳細情報はREFERENCE.mdに移動
- 例はEXAMPLES.mdに分離

### 3. TodoWrite統合のパワー

複数ステップのワークフローでは、TodoWriteツールの使用が重要です：
- **進捗の可視化**: ユーザーが現在の状態を理解できる
- **タスク管理**: 複雑なプロセスを追跡可能なステップに分解
- **品質保証**: 各ステップの完了を検証してから次に進む

### 4. メタスキルの自己参照性

メタスキルは自己参照的な性質を持ちます：
- skill-creator自体がスキルのベストプラクティスの例
- 自身の構造が、作成するスキルのテンプレートとして機能
- この自己参照性により、一貫性のある高品質なスキルが生成される

## ベストプラクティス

### Do's ✅
- 説明文をアクション指向で具体的にする
- 複数ステップワークフローにTodoWriteを使用
- 具体的な例を提供
- YAMLフロントマター構文を検証
- 配布前にスキルをテスト
- エッジケースとトラブルシューティングを文書化
- セキュリティが重要な操作には`allowed-tools`を使用
- SKILL.mdを焦点を絞った内容に保つ（詳細はサポートファイルへ）

### Don'ts ❌
- スキル名に大文字や特殊文字を使用しない
- 曖昧または一般的な説明を作らない
- 過度に複雑な単一ファイルスキルを作成しない
- トリガーシナリオのテストをスキップしない
- 過剰なツールパーミッションを付与しない
- 検証ステップをスキップしない
- スキルがいつ活性化すべきかの説明を忘れない

## 使い方

### skill-creator メタスキルのインストール

#### 個人用（自分のみ）
```bash
mkdir -p ~/.claude/skills/
cp -r skill-creator ~/.claude/skills/
```

#### プロジェクト用（チーム共有）
```bash
mkdir -p .claude/skills/
cp -r skill-creator .claude/skills/
git add .claude/skills/skill-creator/
git commit -m "Add skill-creator meta skill"
git push
```

### 使用例

単にClaudeに以下のように依頼します：

```
"I want to create a skill for automating database migrations"
```

または

```
"Help me create a skill that reviews pull requests for security issues"
```

skill-creatorが自動的に活性化し、要件の明確化から実装、テストまでガイドします。

## 制限事項と今後の課題

### 現在の制限

1. **スラッシュコマンドメタスキル**: 調査中（ドキュメントが一時的に利用不可）
2. **プラグインメタスキル**: より複雑な構造のため未実装
3. **バージョン管理**: スキルのバージョニング戦略は含まれていない
4. **依存性管理**: スキル間の依存関係の処理が未実装

### 今後の改善

1. **テンプレートライブラリ**: 一般的なスキルパターン用のテンプレート集
2. **スキルリンター**: スキルの品質とベストプラクティスを自動チェック
3. **スキルマーケットプレイス**: コミュニティスキルの共有と発見
4. **バージョン管理**: スキルのsemverとアップグレードパス
5. **依存性解決**: スキルが他のスキルやプラグインに依存できるように

## 結論

### 主な発見

1. **メタスキルは実用的**: スキルを作成するスキルは、開発者の生産性を大幅に向上させる
2. **設計パターンが重要**: 4つの主要パターン（ワークフロー自動化、コード生成、分析＆レビュー、インタラクティブガイド）が汎用性を提供
3. **description が鍵**: 適切に書かれた description により、Claudeはスキルを正確に発見できる
4. **段階的開示が効率的**: SKILL.mdを焦点を絞った内容にし、詳細をサポートファイルに分離することで、コンテキスト効率が向上

### 推奨事項

**スキル開発者向け:**
- skill-creatorメタスキルを使用して新しいスキルを作成
- 公式ベストプラクティスに従う
- チーム共有のためにプロジェクトスキルとしてコミット

**Claude Code チーム向け（提案）:**
- skill-creatorのような公式メタスキルをデフォルトで提供
- スキルリンターとバリデーターを開発
- コミュニティスキルマーケットプレイスを検討

**研究者向け:**
- メタプログラミングとAIアシスタントの交差点を探索
- スキルの構成可能性と再利用性を研究
- スキル間の依存関係と相互作用を調査

## 参考資料

- [Claude Code Skills Documentation](https://code.claude.com/docs/en/skills.md)
- [Claude Code Plugins Documentation](https://code.claude.com/docs/en/plugins.md)
- session-start-hook スキル（既存の参考実装）

## ライセンスと注意事項

このプロジェクトは実験的な研究プロジェクトです。

- **実験的**: 本番環境での使用は十分なテストとレビュー後に推奨
- **AI生成**: すべてのコードとドキュメントはAIによって生成されています
- **オープンソース**: 自由に使用、改変、配布可能
