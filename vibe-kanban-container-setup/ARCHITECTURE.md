# vibe-kanban アーキテクチャと実行モデル

vibe-kanbanのアーキテクチャとコーディングエージェントの実行モデルについて解説します。

## 目次

1. [vibe-kanbanとは](#vibe-kanbanとは)
2. [アーキテクチャ概要](#アーキテクチャ概要)
3. [エージェントの実行場所](#エージェントの実行場所)
4. [コンテナ化における重要な理解](#コンテナ化における重要な理解)
5. [MCP（Model Context Protocol）](#mcpmodel-context-protocol)
6. [実装パターン](#実装パターン)

---

## vibe-kanbanとは

### 役割

vibe-kanbanは**AIコーディングエージェントのオーケストレーションツール**です。

**vibe-kanban自体はコーディングエージェントではありません。**

主な機能：
- 📋 **カンバンボード**: タスクの可視化と管理
- 🔄 **オーケストレーション**: 複数エージェントの並列・直列実行管理
- ⚙️ **設定管理**: エージェント設定の一元管理
- 📊 **進捗追跡**: 各エージェントのステータス監視
- 🔍 **コードレビュー**: 生成されたコードの確認

### vibe-kanbanが**しないこと**

- ❌ コードを直接生成しない
- ❌ AIモデルを実行しない
- ❌ エージェントCLIツールを含まない

---

## アーキテクチャ概要

### 全体構成

```
┌─────────────────────────────────────────────────┐
│              ホストマシン                          │
│                                                 │
│  ┌──────────────────────────────────────────┐  │
│  │  AIコーディングエージェント（MCP Client）   │  │
│  ├──────────────────────────────────────────┤  │
│  │  • Claude Code (claude-cli)              │  │
│  │  • Gemini CLI (gemini-cli)               │  │
│  │  • Cursor CLI (cursor-agent)             │  │
│  │  • GitHub Copilot CLI (gh copilot)       │  │
│  │  • OpenAI Codex                          │  │
│  └──────────────┬───────────────────────────┘  │
│                 │                               │
│                 │ MCP / API                     │
│                 │                               │
│  ┌──────────────▼───────────────────────────┐  │
│  │  vibe-kanban (Webアプリ)                  │  │
│  │  ┌────────────────────────────────────┐  │  │
│  │  │  • Webベースカンバンボード           │  │  │
│  │  │  • タスク管理UI                      │  │  │
│  │  │  • エージェント設定管理               │  │  │
│  │  │  • 進捗追跡・可視化                  │  │  │
│  │  └────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────┐  │  │
│  │  │  バックエンド (Rust)                 │  │  │
│  │  │  • REST API                         │  │  │
│  │  │  • タスク管理ロジック                 │  │  │
│  │  │  • 設定ファイル管理                  │  │  │
│  │  └────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────┘  │
│                                                 │
│  ┌──────────────────────────────────────────┐  │
│  │  プロジェクトファイル (/repos)             │  │
│  │  • ソースコード                           │  │
│  │  • Git リポジトリ                         │  │
│  │  • エージェントの作業領域                  │  │
│  └──────────────────────────────────────────┘  │
└─────────────────────────────────────────────────┘
```

### コンポーネント

#### 1. AIコーディングエージェント（ホスト側）

- **インストール場所**: ホストマシン
- **実行場所**: ホストマシンのプロセス
- **役割**: 実際のコード生成、AIモデルとの通信

#### 2. vibe-kanban（コンテナまたはホスト）

- **構成**: Webアプリケーション（Rust + TypeScript）
- **役割**: 管理・オーケストレーション
- **ポート**: 3000（デフォルト）

#### 3. プロジェクトファイル

- **場所**: ホストマシン（コンテナにマウント）
- **役割**: エージェントが操作する実際のコード

---

## エージェントの実行場所

### ❌ 誤解：コンテナ内でエージェントを実行

```
┌─────────────────────────────────┐
│  vibe-kanbanコンテナ             │
│  ┌───────────────────────────┐  │
│  │  ❌ claude-cli            │  │  ← 不要！
│  │  ❌ gemini-cli            │  │
│  │  ❌ cursor-agent          │  │
│  │  ✅ vibe-kanban (Webアプリ) │  │
│  └───────────────────────────┘  │
└─────────────────────────────────┘
```

**vibe-kanbanコンテナ内にエージェントをインストールする必要はありません！**

### ✅ 正しい理解：ホスト側でエージェントを実行

```
┌─────────────────────────────────────────────────┐
│  ホストマシン                                      │
│  ┌──────────────────────────────────────────┐  │
│  │  ✅ claude-cli (認証済み)                  │  │
│  │  ✅ gemini-cli (認証済み)                  │  │
│  │  ✅ cursor-agent (認証済み)                │  │
│  └──────────────────────────────────────────┘  │
│                     ↕                           │
│  ┌──────────────────────────────────────────┐  │
│  │  Docker コンテナ                           │  │
│  │  ┌────────────────────────────────────┐  │  │
│  │  │  vibe-kanban (Webアプリのみ)         │  │  │
│  │  └────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────┘  │
└─────────────────────────────────────────────────┘
```

**エージェントはホスト側で認証・実行し、vibe-kanbanはそれらを管理するだけです。**

---

## コンテナ化における重要な理解

### vibe-kanbanコンテナの内容

**含まれるもの**:
- ✅ vibe-kanban Webアプリケーション（Rust + TypeScript）
- ✅ Node.js ランタイム
- ✅ 必要な依存ライブラリ

**含まれないもの**:
- ❌ Claude Code CLI
- ❌ Gemini CLI
- ❌ Cursor CLI
- ❌ GitHub Copilot CLI
- ❌ その他のエージェントツール

### なぜコンテナ内にエージェントが不要なのか

#### 理由1: アーキテクチャの設計

vibe-kanbanは**オーケストレーター**であり、**実行環境**ではありません。

- エージェントのCLIツールはホストで実行
- vibe-kanbanはタスク管理とUI提供のみ

#### 理由2: 認証の複雑さ

各エージェントは固有の認証フローを持ちます：

- Claude Code: ブラウザでログイン、またはAPI key
- Gemini CLI: Google アカウント認証
- Cursor CLI: ブラウザでログイン
- GitHub Copilot: GitHub認証とデバイスフロー

これらをコンテナ内で実行するのは非常に複雑です。

#### 理由3: ホスト側の設定ファイル

エージェントは設定をホスト側のファイルに保存します：

```bash
~/.claude/config        # Claude Code設定
~/.config/gemini/       # Gemini CLI設定
~/.cursor/              # Cursor CLI設定
~/.config/github-copilot/  # GitHub Copilot設定
```

vibe-kanbanは**これらの設定を参照・更新**します。

#### 理由4: プロジェクトへのアクセス

エージェントはホスト側のプロジェクトファイルを直接操作します：

```bash
~/projects/my-app/      # エージェントの作業ディレクトリ
```

コンテナ内のエージェントからは、これらのファイルにアクセスするのが困難です。

---

## MCP（Model Context Protocol）

### MCPとは

**Model Context Protocol**は、AIエージェントとツール間の標準的な通信プロトコルです。

### vibe-kanbanにおけるMCP

vibe-kanbanはMCPを使用してエージェントを統合します：

```
┌─────────────────────────────────────────────────┐
│  エージェント（MCPクライアント）                    │
│  • Claude Code                                  │
│  • Gemini CLI                                   │
│  • Cursor CLI                                   │
└──────────────┬──────────────────────────────────┘
               │ MCP Protocol
               │ (標準化されたAPI)
               ▼
┌──────────────────────────────────────────────────┐
│  vibe-kanban（MCPサーバー / オーケストレーター）    │
│  • タスク管理                                     │
│  • 設定管理                                      │
│  • 進捗追跡                                      │
└──────────────────────────────────────────────────┘
```

### MCP設定

vibe-kanbanは各エージェントのMCP設定を管理します：

```bash
# Claude Codeの例
claude mcp add vibe_kanban -s project -- npx -y vibe-kanban --mcp
```

この設定は**エージェントのグローバル設定ファイル**に保存され、vibe-kanbanを停止しても永続化されます。

---

## 実装パターン

### パターン1: すべてホスト側で実行（推奨）

**構成**:
```bash
# ホストマシン
├── エージェント（claude-cli、gemini-cli等）
├── vibe-kanban（npx vibe-kanban）
└── プロジェクトファイル（~/projects/）
```

**メリット**:
- ✅ 最もシンプル
- ✅ 認証が容易
- ✅ ファイルアクセスが直接的

**デメリット**:
- ❌ ホスト環境に依存
- ❌ 隔離性が低い

**実行方法**:

```bash
# 1. エージェントをホストにインストール・認証
npm install -g @anthropic-ai/claude-cli
claude auth login

# 2. vibe-kanbanを起動
npx vibe-kanban

# 3. ブラウザでアクセス
# http://localhost:3000
```

---

### パターン2: vibe-kanbanのみコンテナ化（推奨）

**構成**:
```bash
# ホストマシン
├── エージェント（claude-cli、gemini-cli等）
├── Docker コンテナ
│   └── vibe-kanban（Webアプリ）
└── プロジェクトファイル（~/projects/）
```

**メリット**:
- ✅ vibe-kanbanの隔離
- ✅ エージェント認証が容易
- ✅ ファイルアクセスが可能（ボリュームマウント）
- ✅ エージェントのホスト側管理

**デメリット**:
- ❌ ホストとコンテナ間の通信設定が必要

**実行方法**:

```bash
# 1. ホスト側でエージェントを認証
claude auth login
gemini-cli auth login

# 2. vibe-kanbanをコンテナで起動
docker run -d \
  --name vibe-kanban \
  -p 3000:3000 \
  -v ~/projects:/repos:rw \
  -v ~/.claude:/home/appuser/.claude:ro \
  -v ~/.config/gemini:/home/appuser/.config/gemini:ro \
  -e ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY} \
  vibe-kanban:latest

# 3. ブラウザでアクセス
# http://localhost:3000
```

**重要なポイント**:

エージェントの設定ディレクトリをコンテナにマウントすることで、vibe-kanbanがホスト側のエージェント設定を参照できます：

```bash
-v ~/.claude:/home/appuser/.claude:ro                 # Claude Code設定
-v ~/.config/gemini:/home/appuser/.config/gemini:ro   # Gemini CLI設定
-v ~/.cursor:/home/appuser/.cursor:ro                 # Cursor CLI設定
-v ~/.config/github-copilot:/home/appuser/.config/github-copilot:ro  # Copilot設定
```

---

### パターン3: リモートサーバー構成

**構成**:
```bash
# ローカルマシン
├── エージェント（claude-cli、gemini-cli等）
└── ブラウザ（vibe-kanban UIにアクセス）
         │
         │ HTTP/SSH
         ▼
# リモートサーバー（Docker）
├── vibe-kanbanコンテナ（Webアプリ）
└── プロジェクトファイル
```

**メリット**:
- ✅ リモート開発環境
- ✅ チーム共有可能
- ✅ 強力なサーバーリソース活用

**デメリット**:
- ❌ ネットワーク設定が複雑
- ❌ エージェントの実行場所が分散

**実行方法**:

```bash
# リモートサーバーでvibe-kanbanを起動
docker run -d \
  --name vibe-kanban \
  -p 3000:3000 \
  vibe-kanban:latest

# ローカルマシンでエージェントを実行
# vibe-kanbanのUIはリモートサーバーにアクセス
# http://remote-server:3000
```

---

## まとめ

### 重要なポイント

1. **vibe-kanbanは管理ツール**
   - コーディングエージェントではない
   - タスク管理とオーケストレーションのみ

2. **エージェントはホスト側で実行**
   - コンテナ内にインストール不要
   - ホストで認証・実行

3. **コンテナ化するのはvibe-kanbanのみ**
   - Webアプリケーションとして隔離
   - エージェント設定はボリュームマウント

4. **API keyは環境変数で渡す**
   - コンテナ内でエージェントを実行しないため
   - エージェントがAPI直接呼び出す場合の設定

### 推奨構成

**開発環境**:
- エージェント: ホストにインストール・認証
- vibe-kanban: `npx vibe-kanban`（ホスト実行）

**本番環境**:
- エージェント: ホストにインストール・認証
- vibe-kanban: Dockerコンテナ
- プロジェクト: ボリュームマウント
- エージェント設定: 読み取り専用マウント

### クイックスタート

```bash
# 1. ホスト側でエージェントをインストール・認証
npm install -g @anthropic-ai/claude-cli
claude auth login

# 2. vibe-kanbanを起動（ホストまたはコンテナ）
# ホスト実行の場合:
npx vibe-kanban

# コンテナ実行の場合:
docker run -d \
  --name vibe-kanban \
  -p 3000:3000 \
  -v ~/projects:/repos:rw \
  -v ~/.claude:/home/appuser/.claude:ro \
  vibe-kanban:latest

# 3. ブラウザでアクセス
# http://localhost:3000

# 4. vibe-kanbanのUIからエージェントにタスクを割り当て
```

---

**これで、vibe-kanbanのアーキテクチャと正しい実装方法が理解できました！** 🎯
